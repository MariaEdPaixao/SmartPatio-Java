<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - SmartPatio</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div th:replace="fragments/header :: main-header"></div>

<main class="dash-container">
    <h1><i class="fas fa-chart-line"></i> Dashboard SmartPatio</h1>
    <p class="welcome-message">
        <i class="fas fa-user-circle"></i>
        Olá <strong th:text="${user.nome}"></strong>, que bom ter você aqui!<span class="brand">Monitore as informações do seu pátio.</span></p>
    <div th:if="${#lists.isEmpty(ativos)} and ${#lists.isEmpty(finalizadas)}" class="no-data-message">
        <p><i class="fas fa-info-circle"></i> Sem informações sobre sua filial no momento. Registre uma entrada ou saída para começar a documentar.</p>
    </div>

    <div th:unless="${#lists.isEmpty(ativos)} and ${#lists.isEmpty(finalizadas)}">
    <div class="dashboard-cards">
        <div class="card-summary">
            <i class="fas fa-motorcycle"></i>
            <h3 th:text="${ativos.size()}">0</h3>
            <p>Motos Ativas</p>
        </div>
        <div class="card-summary">
            <i class="fas fa-warehouse"></i>
            <h3 th:text="${finalizadas.size()}">0</h3>
            <p>Motos Saíram</p>
        </div>
        <div class="card-summary">
            <i class="fas fa-battery-half"></i>
            <h3 th:text="${carrapatos.size()}">0</h3>
            <p>Carrapatos Monitorados</p>
        </div>
    </div>

    <h2><i class="fas fa-motorcycle"></i> Motos Ativas no Pátio</h2>
    <table class="dashboard-table">
        <thead>
        <tr>
            <th>Placa</th>
            <th>Carrapato</th>
            <th>Entrada</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${#lists.isEmpty(ativos)}">
            <td colspan="3" class="empty-row">Nenhuma moto registrada</td>
        </tr>
        <tr th:each="h : ${ativos}" th:unless="${#lists.isEmpty(ativos)}">
            <td th:text="${h.moto.placa}">ABC123</td>
            <td th:text="${h.carrapato.codigoSerial}">CAR-001</td>
            <td th:text="${h.dataEntrada != null ? #temporals.format(h.dataEntrada, 'dd/MM/yyyy HH:mm') : '-'}">27/09/2025 18:45</td>
        </tr>
        </tbody>
    </table>

    <h2><i class="fas fa-flag-checkered"></i> Motos que Saíram</h2>
    <table class="dashboard-table">
        <thead>
        <tr>
            <th>Placa</th>
            <th>Carrapato</th>
            <th>Entrada</th>
            <th>Saída</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${#lists.isEmpty(finalizadas)}">
            <td colspan="3" class="empty-row">Nenhuma moto registrada</td>
        </tr>
        <tr th:each="h : ${finalizadas}" th:unless="${#lists.isEmpty(finalizadas)}">
            <td th:text="${h.moto.placa}">XYZ789</td>
            <td th:text="${h.carrapato.codigoSerial}">CAR-002</td>
            <td th:text="${h.dataEntrada != null ? #temporals.format(h.dataEntrada, 'dd/MM/yyyy HH:mm') : '-'}">-</td>
            <td th:text="${h.dataSaida != null ? #temporals.format(h.dataSaida, 'dd/MM/yyyy HH:mm') : '-'}">-</td>
        </tr>
        </tbody>
    </table>

    <h2><i class="fas fa-battery-three-quarters"></i> Nível de Bateria dos Carrapatos</h2>
    <canvas id="graficoBateria" width="400" height="200"></canvas>
        <script th:inline="javascript">
            const labels = /*[[${carrapatoLabels}]]*/ [];
            const data = /*[[${bateriaNiveis}]]*/ [];

            new Chart(document.getElementById('graficoBateria'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Bateria (%)',
                        data: data,
                        backgroundColor: '#009B30'
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });
        </script>
    </div>

    <a href="/filial" class="btn-dashboard">
        <i class="fas fa-plus-circle"></i> Registrar Nova Moto
    </a>
</main>

<div th:replace="fragments/footer :: main-footer"></div>
</body>
</html>
