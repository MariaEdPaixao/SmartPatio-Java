<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Saída de Moto - SmartPatio</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/filial.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
<div th:replace="fragments/header :: main-header"></div>

<main class="patio-container content">

    <h1><i class="fas fa-sign-out-alt"></i> Saída de Moto</h1>
    <p class="subtitle"><i class="fas fa-motorcycle"></i> Simulando saída do pátio...</p>
    <div th:if="${#lists.isEmpty(ativos)}" class="no-data-message">
        <p><i class="fas fa-info-circle"></i> Não existem motos nessa filial para registrar saída.</p>
    </div>
    <div th:unless="${#lists.isEmpty(ativos)}">
    <div id="log" class="console"></div>
    </div>
    <a href="/" class="btn-voltar"><i class="fas fa-arrow-left"></i> Voltar ao menu</a>
</main>

<div th:replace="fragments/footer :: main-footer"></div>

<script th:inline="javascript">
    const placa = /*[[${placa}]]*/ "";
    const carrapato = /*[[${carrapato}]]*/ "";

    function simulateSaida(moto, carrapato) {
        const log = document.getElementById("log");
        log.innerHTML = "<i class='fas fa-search'></i> Detectando moto saindo...";

        setTimeout(() => {log.innerHTML = "<i class='fas fa-check-circle'></i> Moto <b>" + moto + "</b> escaneada";}, 1500);

        setTimeout(() => {log.innerHTML += "<br><span id='loading-carrapato'><i class='fas fa-spinner fa-spin'></i> Desvinculando carrapato...</span>";}, 3000);

        setTimeout(() => {
            const loading = document.getElementById("loading-carrapato");
            if (loading) loading.remove();
            log.innerHTML += "<br><i class='fas fa-check-circle'></i> Carrapato <b>" + carrapato + "</b> liberado";
        }, 4500);

        setTimeout(() => {
            log.innerHTML += "<br><br><i class='fas fa-flag-checkered'></i> Moto <b>" + moto + "</b> saiu do pátio!";
        }, 6000);
    }

    simulateSaida(placa, carrapato);
</script>
</body>
</html>
